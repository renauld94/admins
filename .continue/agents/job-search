#!/bin/bash
# ðŸŽ¯ Job Search Agent Setup & Master Command
# ============================================
# Quick access to all job search functionality

set -e

AGENT_DIR="$HOME/.job_search_agent"
DASHBOARD_FILE="$AGENT_DIR/job_search_dashboard.html"

# Colors
GREEN='\033[0;32m'
BLUE='\033[0;34m'
YELLOW='\033[1;33m'
NC='\033[0m' # No Color

echo -e "${BLUE}â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—${NC}"
echo -e "${BLUE}â•‘     ðŸŽ¯ JOB SEARCH AGENT - SETUP & COMMAND LAUNCHER           â•‘${NC}"
echo -e "${BLUE}â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•${NC}\n"

# Create directories if they don't exist
mkdir -p "$AGENT_DIR"/{opportunities,applications,companies,documents,reports,linkedin_integration}

# Function to show menu
show_menu() {
    echo -e "\n${BLUE}Select an option:${NC}\n"
    echo "  1) Start Interactive Agent"
    echo "  2) View Dashboard"
    echo "  3) Show Statistics"
    echo "  4) Generate Weekly Report"
    echo "  5) List All Opportunities"
    echo "  6) Setup LinkedIn Integration"
    echo "  7) Show Quick Start Guide"
    echo "  8) View Configuration"
    echo "  9) Exit"
    echo ""
}

# Function to run agent command
run_agent() {
    python3 /home/simon/Learning-Management-System-Academy/.continue/agents/job_search_agent.py "$1"
}

# Function to run dashboard
run_dashboard() {
    python3 /home/simon/Learning-Management-System-Academy/.continue/agents/job_search_dashboard.py
    if [ -f "$DASHBOARD_FILE" ]; then
        echo -e "\n${GREEN}âœ… Dashboard generated!${NC}"
        read -p "Open in browser? (y/n) " -n 1 -r
        echo
        if [[ $REPLY =~ ^[Yy]$ ]]; then
            xdg-open "$DASHBOARD_FILE" 2>/dev/null || open "$DASHBOARD_FILE" 2>/dev/null || echo "Please open: $DASHBOARD_FILE"
        fi
    fi
}

# Function to setup LinkedIn
setup_linkedin() {
    echo -e "\n${BLUE}Setting up LinkedIn integration...${NC}\n"
    python3 /home/simon/Learning-Management-System-Academy/.continue/agents/linkedin_job_integration.py
}

# Function to show quick start
show_quickstart() {
    cat /home/simon/Learning-Management-System-Academy/.continue/agents/JOB_SEARCH_QUICK_START.md
}

# Function to show config
show_config() {
    if [ -f "$AGENT_DIR/config.json" ]; then
        echo -e "\n${BLUE}Current Configuration:${NC}\n"
        cat "$AGENT_DIR/config.json" | python3 -m json.tool
    else
        echo -e "${YELLOW}No configuration found. Running agent to create one...${NC}"
        run_agent "--interactive"
    fi
}

# Main loop
while true; do
    show_menu
    read -p "Enter your choice (1-9): " choice

    case $choice in
        1)
            echo -e "\n${BLUE}Launching Interactive Agent...${NC}\n"
            run_agent "--interactive"
            ;;
        2)
            echo -e "\n${BLUE}Generating Dashboard...${NC}\n"
            run_dashboard
            ;;
        3)
            echo -e "\n${BLUE}Showing Statistics...${NC}\n"
            run_agent "--stats"
            ;;
        4)
            echo -e "\n${BLUE}Generating Weekly Report...${NC}\n"
            run_agent "--report"
            ;;
        5)
            echo -e "\n${BLUE}Listing All Opportunities...${NC}\n"
            run_agent "--list"
            ;;
        6)
            setup_linkedin
            ;;
        7)
            show_quickstart
            ;;
        8)
            show_config
            ;;
        9)
            echo -e "\n${GREEN}ðŸ‘‹ Goodbye! Keep pushing forward with your job search!${NC}\n"
            exit 0
            ;;
        *)
            echo -e "\n${YELLOW}Invalid choice. Please try again.${NC}"
            ;;
    esac
done
