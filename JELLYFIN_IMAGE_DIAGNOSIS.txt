â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘                                                                          â•‘
â•‘   ğŸ” JELLYFIN IMAGE ISSUE - ROOT CAUSE ANALYSIS                         â•‘
â•‘   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•                       â•‘
â•‘                                                                          â•‘
â•‘   Date: November 6, 2025 11:05 AM                                       â•‘
â•‘   Analyzed: log_20251106.log (1.8 MB)                                   â•‘
â•‘                                                                          â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•


â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
âœ… SYSTEM STATUS
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

Server Information:
  âœ… Jellyfin Version: 10.10.7
  âœ… Server Name: 92a7a8ae540f
  âœ… API Key: VALID (f870ddf7...091b10a8)
  âœ… External URL: https://jellyfin.simondatalab.de
  âœ… Internal IP: 136.243.155.166:8096

Live TV Status:
  âœ… Total Channels: 2,340 channels in Jellyfin database
  âœ… M3U Channels: 311 channels in our enhanced M3U
  âœ… Working Channels: 286 (92%) tested and functional
  âœ… Channels with Logos: 311 (100%) - all have tvg-logo metadata

Recent Activity:
  âœ… User connections: simonadmin active from Chrome, Smart TV, Pixel 7 Pro
  âœ… Last activity: 2025-11-06 04:13 AM
  âœ… No authentication errors
  âœ… FFmpeg transcoding working (multiple successful streams)


â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
âŒ ROOT CAUSE: IMAGE 500 ERRORS
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

Error Pattern in Logs:
  [ERR] Jellyfin.Api.Middleware.ExceptionMiddleware: 
  Error processing request. URL "GET" "/Items/.../Images/Primary"

Total Image Errors Found: 50+ in recent logs

Error Type Breakdown:
  
  1. ğŸ• TIMEOUT ERRORS (76% - 38 occurrences)
     â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
     Error: "The request was canceled due to the configured 
            HttpClient.Timeout of 100 seconds elapsing"
     
     What's happening:
       â€¢ Jellyfin tries to fetch images from external URLs (tvg-logo)
       â€¢ External servers (imgur.com, wikimedia.org, etc.) respond slowly
       â€¢ Request takes >100 seconds â†’ timeout â†’ returns HTTP 500 to client
       â€¢ Browser sees 500 Internal Server Error for image
     
     Example URLs that timeout:
       - https://upload.wikimedia.org/...
       - https://i.imgur.com/...
       - Various IPTV provider logo CDNs
  
  2. ğŸ”Œ SOCKET/NETWORK ERRORS (24% - 12 occurrences)
     â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
     Error: "System.Net.Sockets.SocketException (11): 
            Resource temporarily unavailable (upload.wikimedia.org:443)"
     
     What's happening:
       â€¢ Too many concurrent connections to external image hosts
       â€¢ Network resources exhausted (file descriptors, connections)
       â€¢ External hosts rate-limiting or blocking requests
       â€¢ DNS resolution failures for external domains
     
     Affected domains:
       - upload.wikimedia.org (most common)
       - Various CDN servers


â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ğŸ”§ WHY THIS IS HAPPENING
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

Jellyfin's Image Handling Process:

  1. Browser requests channel image: /Items/{id}/Images/Primary
  
  2. Jellyfin checks local cache:
     - Cache location: /var/lib/jellyfin/data/cache/images/
     - If cached â†’ serve immediately (fast, always works)
     - If NOT cached â†’ proceed to step 3
  
  3. Jellyfin tries to download from tvg-logo URL:
     - Fetches from external server (imgur, wikimedia, etc.)
     - 100 second timeout configured
     - If successful â†’ cache locally â†’ serve to browser
     - If timeout/error â†’ return 500 error to browser
  
  4. The Problem:
     - 2,340 channels = 2,340 different logo URLs
     - Many external servers are slow/unreliable
     - Simultaneous requests overwhelm network
     - Cache is empty or outdated
     - Every page load triggers fresh downloads


â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
âœ… SOLUTIONS
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

Solution 1: Pre-populate Image Cache (RECOMMENDED)
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

This will download all channel logos in advance, so they're served from cache.

Via Jellyfin Dashboard:
  1. Open: http://136.243.155.166:8096/web/index.html#!/dashboard
  2. Navigate to: Dashboard â†’ Scheduled Tasks
  3. Find: "Extract Chapter Images" or "Scan Library"
  4. Click: Run Now
  5. Wait: 10-30 minutes for all images to download

Via API (AUTOMATED):
  
  curl -X POST \
    -H "X-MediaBrowser-Token: f870ddf763334cfba15fb45b091b10a8" \
    "http://136.243.155.166:8096/Library/Refresh"
  
  This triggers a full library scan that will:
    â€¢ Validate all channel metadata
    â€¢ Download missing images to cache
    â€¢ Update database with image information

Expected Result:
  âœ… All 2,340 channel images downloaded to local cache
  âœ… Future requests served instantly from disk
  âœ… No more 500 errors (unless cache is cleared)


Solution 2: Increase Timeout (TEMPORARY FIX)
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

Requires editing Jellyfin configuration:

  SSH to server:
    ssh root@10.0.0.103
  
  Edit config (if Docker):
    docker exec -it jellyfin vi /config/network.xml
    
    Find: <HttpClientTimeout>100</HttpClientTimeout>
    Change to: <HttpClientTimeout>300</HttpClientTimeout>
  
  Restart Jellyfin:
    docker restart jellyfin

Expected Result:
  âš ï¸  More images may load, but slower
  âš ï¸  Still fails for very slow/dead URLs
  âš ï¸  Increases server resource usage


Solution 3: Use Faster Logo Sources (LONG TERM)
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

Update M3U file with logos from faster CDNs:

  Options:
    â€¢ Host logos on your own CDN (Cloudflare R2, AWS S3)
    â€¢ Use IPTV-Org's GitHub-hosted logos (faster than wikimedia)
    â€¢ Create fallback logo for channels without images
  
  Implementation:
    1. Download all logos locally
    2. Upload to fast CDN
    3. Update M3U tvg-logo URLs
    4. Refresh Jellyfin metadata

Expected Result:
  âœ… Faster image loading from reliable source
  âœ… Full control over image availability
  âœ… Consistent quality and sizing


Solution 4: Disable External Image Fetching
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

Configure Jellyfin to only use cached images:

  Dashboard â†’ Settings â†’ Library:
    â€¢ Uncheck: "Download images in advance"
    â€¢ Enable: "Save artwork into media folders"
  
  Then manually populate cache once (Solution 1)

Expected Result:
  âœ… No more external fetching attempts
  âœ… No timeout errors
  âš ï¸  New channels won't have images until manually added


â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ğŸš€ RECOMMENDED ACTION PLAN
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

IMMEDIATE (Do Now - 5 minutes):

  1. Trigger library refresh via API:
     
     curl -X POST \
       -H "X-MediaBrowser-Token: f870ddf763334cfba15fb45b091b10a8" \
       "http://136.243.155.166:8096/Library/Refresh"
     
     This starts the image download process in background.

  2. Install Tampermonkey scrollBehavior fix:
     
     bash scripts/install-tampermonkey-script.sh
     
     Fixes the JavaScript error in Live TV guide.


SHORT TERM (Next 30 minutes):

  3. Monitor the library refresh progress:
     - Check Dashboard â†’ Scheduled Tasks
     - Look for "Scan Library" or "Refresh Metadata"
     - Wait for State: Idle (means complete)

  4. Test image loading:
     - Open: https://jellyfin.simondatalab.de
     - Navigate to: Live TV â†’ Channels
     - Press F12 â†’ Console
     - Verify: No 500 errors for images


LONG TERM (This week):

  5. Setup automated cache warming:
     - Schedule weekly "Library Refresh" task
     - Ensures new channels get images downloaded
     - Prevents cache staleness

  6. Consider hosting logos yourself:
     - Upload to Cloudflare R2 (free tier: 10GB)
     - Update M3U with R2 URLs
     - Instant global CDN delivery


â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ğŸ“Š ADDITIONAL FINDINGS
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

Other Issues Found in Logs:

  1. âš ï¸  M3U Simultaneous Stream Limit Reached
     Error: "M3U simultaneous stream limit has been reached"
     Impact: Users can't watch multiple channels at once
     Fix: Dashboard â†’ Live TV â†’ Tuner Devices â†’ 
          Increase "Max Active Streams" setting

  2. âš ï¸  Playback Info Errors
     Error: "Unable to find host to play channel"
     Impact: Some channels fail to play
     Cause: Stream limits or tuner configuration
     Fix: Adjust stream limits or add more tuners


â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ğŸ“‹ QUICK COMMANDS
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

# Trigger library refresh (download images):
curl -X POST -H "X-MediaBrowser-Token: f870ddf763334cfba15fb45b091b10a8" \
  "http://136.243.155.166:8096/Library/Refresh"

# Check scheduled tasks status:
curl -s -H "X-MediaBrowser-Token: f870ddf763334cfba15fb45b091b10a8" \
  "http://136.243.155.166:8096/ScheduledTasks" | \
  python3 -c "import sys,json; [print(f\"{t['Name']:40s} State: {t['State']}\") for t in json.load(sys.stdin) if 'Scan' in t['Name'] or 'Refresh' in t['Name']]"

# Count recent image errors:
curl -s -H "X-MediaBrowser-Token: f870ddf763334cfba15fb45b091b10a8" \
  "http://136.243.155.166:8096/System/Logs/Log?name=log_20251106.log" | \
  grep -c "Images/Primary"

# Test specific channel image:
curl -I -H "X-MediaBrowser-Token: f870ddf763334cfba15fb45b091b10a8" \
  "http://136.243.155.166:8096/Items/{CHANNEL_ID}/Images/Primary"

# View log analysis:
cat /home/simon/Learning-Management-System-Academy/JELLYFIN_IMAGE_DIAGNOSIS.txt


â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
âœ… CONCLUSION
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

Status: âœ… JELLYFIN IS WORKING CORRECTLY

The 500 image errors are NOT a bug or configuration issue.
They are expected behavior when:
  â€¢ Images not yet cached locally
  â€¢ External logo URLs are slow/unreachable
  â€¢ Network temporarily unavailable

Solution: Pre-populate the cache once, then all images load instantly.

Next Step: Run the library refresh command above!

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
