<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Vietnamese Course Enhancement - Live Dashboard</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: #333;
            padding: 20px;
            min-height: 100vh;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
        }
        
        .header {
            background: white;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            margin-bottom: 20px;
            text-align: center;
        }
        
        .header h1 {
            color: #667eea;
            font-size: 2.5em;
            margin-bottom: 10px;
        }
        
        .status-bar {
            display: flex;
            justify-content: space-around;
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            padding: 20px;
            border-radius: 15px;
            margin-top: 15px;
        }
        
        .status-item {
            text-align: center;
            color: white;
        }
        
        .status-item .label {
            font-size: 0.9em;
            opacity: 0.9;
        }
        
        .status-item .value {
            font-size: 2em;
            font-weight: bold;
            margin-top: 5px;
        }
        
        .grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }
        
        .card {
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }
        
        .card h2 {
            color: #667eea;
            margin-bottom: 20px;
            font-size: 1.5em;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .metric {
            margin-bottom: 15px;
        }
        
        .metric-label {
            display: flex;
            justify-content: space-between;
            margin-bottom: 5px;
            font-weight: 600;
        }
        
        .progress-bar {
            height: 25px;
            background: #e0e0e0;
            border-radius: 12px;
            overflow: hidden;
            position: relative;
        }
        
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #667eea 0%, #764ba2 100%);
            transition: width 0.5s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
            font-size: 0.85em;
        }
        
        .log-container {
            background: #1e1e1e;
            border-radius: 10px;
            padding: 20px;
            max-height: 400px;
            overflow-y: auto;
            font-family: 'Courier New', monospace;
            font-size: 0.9em;
        }
        
        .log-entry {
            padding: 5px 0;
            border-bottom: 1px solid #333;
        }
        
        .log-entry.error {
            color: #ff6b6b;
        }
        
        .log-entry.success {
            color: #51cf66;
        }
        
        .log-entry.info {
            color: #74c0fc;
        }
        
        .log-entry.warning {
            color: #ffd43b;
        }
        
        .controls {
            display: flex;
            gap: 15px;
            margin-top: 20px;
        }
        
        .btn {
            flex: 1;
            padding: 15px 30px;
            border: none;
            border-radius: 10px;
            font-size: 1em;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: 0 3px 10px rgba(0,0,0,0.2);
        }
        
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
        }
        
        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }
        
        .btn-danger {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            color: white;
        }
        
        .btn-warning {
            background: linear-gradient(135deg, #ffd43b 0%, #ff922b 100%);
            color: white;
        }
        
        .phase-indicator {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 10px;
            margin-top: 15px;
        }
        
        .phase {
            padding: 15px;
            background: #f8f9fa;
            border-radius: 10px;
            text-align: center;
            border: 2px solid transparent;
            transition: all 0.3s;
        }
        
        .phase.active {
            border-color: #667eea;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            transform: scale(1.05);
        }
        
        .phase.completed {
            background: #51cf66;
            color: white;
        }
        
        .chart-container {
            height: 250px;
            margin-top: 20px;
        }
        
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }
        
        .live-indicator {
            display: inline-block;
            width: 12px;
            height: 12px;
            background: #51cf66;
            border-radius: 50%;
            margin-right: 8px;
            animation: pulse 2s infinite;
        }
        
        .offline-indicator {
            display: inline-block;
            width: 12px;
            height: 12px;
            background: #ff6b6b;
            border-radius: 50%;
            margin-right: 8px;
        }
        
        .last-update {
            text-align: center;
            color: white;
            margin-top: 20px;
            font-size: 0.9em;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üöÄ Vietnamese Course Enhancement Dashboard</h1>
            <div class="status-bar">
                <div class="status-item">
                    <div class="label">Status</div>
                    <div class="value" id="agent-status">
                        <span class="live-indicator"></span>ACTIVE
                    </div>
                </div>
                <div class="status-item">
                    <div class="label">Runtime</div>
                    <div class="value" id="runtime">00:00:00</div>
                </div>
                <div class="status-item">
                    <div class="label">Remaining</div>
                    <div class="value" id="remaining">24:00:00</div>
                </div>
                <div class="status-item">
                    <div class="label">Success Rate</div>
                    <div class="value" id="success-rate">0%</div>
                </div>
            </div>
        </div>
        
        <div class="grid">
            <div class="card">
                <h2>üìä Enhancement Metrics</h2>
                
                <div class="metric">
                    <div class="metric-label">
                        <span>Pages Enhanced</span>
                        <span id="pages-count">0 / 83</span>
                    </div>
                    <div class="progress-bar">
                        <div class="progress-fill" id="pages-progress" style="width: 0%">0%</div>
                    </div>
                </div>
                
                <div class="metric">
                    <div class="metric-label">
                        <span>Widgets Deployed</span>
                        <span id="widgets-count">0 / 83</span>
                    </div>
                    <div class="progress-bar">
                        <div class="progress-fill" id="widgets-progress" style="width: 0%">0%</div>
                    </div>
                </div>
                
                <div class="metric">
                    <div class="metric-label">
                        <span>Media Generated</span>
                        <span id="media-count">0 / 200</span>
                    </div>
                    <div class="progress-bar">
                        <div class="progress-fill" id="media-progress" style="width: 0%">0%</div>
                    </div>
                </div>
                
                <div class="metric">
                    <div class="metric-label">
                        <span>Features Added</span>
                        <span id="features-count">0 / 20</span>
                    </div>
                    <div class="progress-bar">
                        <div class="progress-fill" id="features-progress" style="width: 0%">0%</div>
                    </div>
                </div>
                
                <div class="metric">
                    <div class="metric-label">
                        <span>Errors Encountered</span>
                        <span id="errors-count">0</span>
                    </div>
                </div>
            </div>
            
            <div class="card">
                <h2>‚öôÔ∏è Current Phase</h2>
                <div class="phase-indicator">
                    <div class="phase" id="phase-1">
                        <div style="font-size: 2em;">1</div>
                        <div>Content</div>
                        <div style="font-size: 0.8em;">8 hours</div>
                    </div>
                    <div class="phase" id="phase-2">
                        <div style="font-size: 2em;">2</div>
                        <div>Widgets</div>
                        <div style="font-size: 0.8em;">4 hours</div>
                    </div>
                    <div class="phase" id="phase-3">
                        <div style="font-size: 2em;">3</div>
                        <div>Media</div>
                        <div style="font-size: 0.8em;">6 hours</div>
                    </div>
                    <div class="phase" id="phase-4">
                        <div style="font-size: 2em;">4</div>
                        <div>Advanced</div>
                        <div style="font-size: 0.8em;">6 hours</div>
                    </div>
                </div>
                
                <h2 style="margin-top: 30px;">üñ•Ô∏è System Resources</h2>
                
                <div class="metric">
                    <div class="metric-label">
                        <span>CPU Usage</span>
                        <span id="cpu-usage">0%</span>
                    </div>
                    <div class="progress-bar">
                        <div class="progress-fill" id="cpu-progress" style="width: 0%; background: linear-gradient(90deg, #51cf66 0%, #ff922b 50%, #ff6b6b 100%);">0%</div>
                    </div>
                </div>
                
                <div class="metric">
                    <div class="metric-label">
                        <span>Memory Usage</span>
                        <span id="mem-usage">0%</span>
                    </div>
                    <div class="progress-bar">
                        <div class="progress-fill" id="mem-progress" style="width: 0%; background: linear-gradient(90deg, #51cf66 0%, #ff922b 50%, #ff6b6b 100%);">0%</div>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="card">
            <h2>üìã Recent Activity Log</h2>
            <div class="log-container" id="log-container">
                <div class="log-entry info">Initializing dashboard...</div>
            </div>
        </div>
        
        <div class="card">
            <h2>üéÆ Controls</h2>
            <div class="controls">
                <button class="btn btn-primary" onclick="restartAgent()">üîÑ Restart Agent</button>
                <button class="btn btn-danger" onclick="stopAgent()">‚èπÔ∏è Stop Agent</button>
                <button class="btn btn-warning" onclick="togglePause()">‚è∏Ô∏è Pause/Resume</button>
            </div>
        </div>
        
        <div class="last-update">
            Last updated: <span id="last-update">Never</span> | Auto-refresh: 3 seconds
        </div>
    </div>
    
    <script>
        let isPaused = false;
        
        // Fetch metrics from log file via API
        async function fetchMetrics() {
            try {
                // In production, this would call an actual API endpoint
                // For now, we'll simulate with random data for demo
                
                const response = await fetch('epic_enhancement.log');
                const logText = await response.text();
                
                // Parse metrics from log
                const pagesMatch = logText.match(/Pages Enhanced:\s+(\d+)/);
                const widgetsMatch = logText.match(/Widgets Deployed:\s+(\d+)/);
                const mediaMatch = logText.match(/Media Generated:\s+(\d+)/);
                const featuresMatch = logText.match(/Features Added:\s+(\d+)/);
                const errorsMatch = logText.match(/Errors:\s+(\d+)/);
                const successMatch = logText.match(/SUCCESS RATE:\s+([\d.]+)/);
                
                return {
                    pages: pagesMatch ? parseInt(pagesMatch[1]) : 0,
                    widgets: widgetsMatch ? parseInt(widgetsMatch[1]) : 0,
                    media: mediaMatch ? parseInt(mediaMatch[1]) : 0,
                    features: featuresMatch ? parseInt(featuresMatch[1]) : 0,
                    errors: errorsMatch ? parseInt(errorsMatch[1]) : 0,
                    successRate: successMatch ? parseFloat(successMatch[1]) : 0,
                    logs: logText.split('\n').slice(-15)
                };
            } catch (error) {
                console.error('Failed to fetch metrics:', error);
                return null;
            }
        }
        
        // Update dashboard
        async function updateDashboard() {
            const metrics = await fetchMetrics();
            if (!metrics) return;
            
            // Update pages
            document.getElementById('pages-count').textContent = `${metrics.pages} / 83`;
            const pagesPercent = Math.round((metrics.pages / 83) * 100);
            document.getElementById('pages-progress').style.width = `${pagesPercent}%`;
            document.getElementById('pages-progress').textContent = `${pagesPercent}%`;
            
            // Update widgets
            document.getElementById('widgets-count').textContent = `${metrics.widgets} / 83`;
            const widgetsPercent = Math.round((metrics.widgets / 83) * 100);
            document.getElementById('widgets-progress').style.width = `${widgetsPercent}%`;
            document.getElementById('widgets-progress').textContent = `${widgetsPercent}%`;
            
            // Update media
            document.getElementById('media-count').textContent = `${metrics.media} / 200`;
            const mediaPercent = Math.round((metrics.media / 200) * 100);
            document.getElementById('media-progress').style.width = `${mediaPercent}%`;
            document.getElementById('media-progress').textContent = `${mediaPercent}%`;
            
            // Update features
            document.getElementById('features-count').textContent = `${metrics.features} / 20`;
            const featuresPercent = Math.round((metrics.features / 20) * 100);
            document.getElementById('features-progress').style.width = `${featuresPercent}%`;
            document.getElementById('features-progress').textContent = `${featuresPercent}%`;
            
            // Update errors
            document.getElementById('errors-count').textContent = metrics.errors;
            
            // Update success rate
            document.getElementById('success-rate').textContent = `${metrics.successRate}%`;
            
            // Update logs
            const logContainer = document.getElementById('log-container');
            logContainer.innerHTML = '';
            metrics.logs.forEach(log => {
                const entry = document.createElement('div');
                entry.className = 'log-entry';
                
                if (log.includes('ERROR')) entry.classList.add('error');
                else if (log.includes('SUCCESS') || log.includes('‚úì')) entry.classList.add('success');
                else if (log.includes('INFO')) entry.classList.add('info');
                else if (log.includes('WARNING')) entry.classList.add('warning');
                
                entry.textContent = log;
                logContainer.appendChild(entry);
            });
            
            // Auto-scroll to bottom
            logContainer.scrollTop = logContainer.scrollHeight;
            
            // Update timestamp
            document.getElementById('last-update').textContent = new Date().toLocaleTimeString();
        }
        
        // Update runtime
        let startTime = Date.now();
        function updateRuntime() {
            const elapsed = Math.floor((Date.now() - startTime) / 1000);
            const hours = Math.floor(elapsed / 3600);
            const minutes = Math.floor((elapsed % 3600) / 60);
            const seconds = elapsed % 60;
            
            document.getElementById('runtime').textContent = 
                `${String(hours).padStart(2, '0')}:${String(minutes).padStart(2, '0')}:${String(seconds).padStart(2, '0')}`;
            
            const remaining = Math.max(0, (24 * 3600) - elapsed);
            const remHours = Math.floor(remaining / 3600);
            const remMinutes = Math.floor((remaining % 3600) / 60);
            const remSeconds = remaining % 60;
            
            document.getElementById('remaining').textContent = 
                `${String(remHours).padStart(2, '0')}:${String(remMinutes).padStart(2, '0')}:${String(remSeconds).padStart(2, '0')}`;
        }
        
        // Control functions
        function restartAgent() {
            if (confirm('Are you sure you want to restart the agent? This will reset progress.')) {
                alert('Agent restarting... (In production, this would call: sudo systemctl restart vietnamese-epic-enhancement)');
            }
        }
        
        function stopAgent() {
            if (confirm('Are you sure you want to stop the agent?')) {
                alert('Agent stopping... (In production, this would call: sudo systemctl stop vietnamese-epic-enhancement)');
            }
        }
        
        function togglePause() {
            isPaused = !isPaused;
            if (isPaused) {
                alert('Agent paused... (In production, this would call: sudo systemctl stop vietnamese-epic-enhancement)');
            } else {
                alert('Agent resumed... (In production, this would call: sudo systemctl start vietnamese-epic-enhancement)');
            }
        }
        
        // Auto-update
        setInterval(updateDashboard, 3000);
        setInterval(updateRuntime, 1000);
        
        // Initial load
        updateDashboard();
        updateRuntime();
    </script>
</body>
</html>
