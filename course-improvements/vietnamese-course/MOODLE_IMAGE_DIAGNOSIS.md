# Moodle image load diagnosis (course-default.svg)

Follow these steps to diagnose and fix the `course-default.svg` image that fails to load on `https://moodle.simondatalab.de`.

1) Confirm the exact URL and HTTP status

```bash
curl -I 'https://moodle.simondatalab.de/theme/image.php/boost/core/1761792253/f/image'
```

- Expect HTTP 200 and a valid Content-Type (e.g., `image/svg+xml`). If you get 404 or 403 note the response and time.

2) Purge Moodle caches (admin)

- In the Moodle UI: Site administration -> Development -> Purge caches
- Or (admin required): https://moodle.simondatalab.de/admin/purgecaches.php

3) Check the theme and file paths on the Moodle host

- Inspect your theme's pix folder (the path depends on your theme):

```bash
ls -l /var/www/moodle/theme/boost/pix_core/*
ls -l /var/www/moodle/theme/yourtheme/pix/*
```

- If the image is missing in the theme, re-deploy the theme assets (see your EPIC theme deployment docs in `.github/instructions/EPIC-THEME-DEPLOYMENT-COMPLETE.md`).

4) Inspect webserver / proxy logs for 404/403

```bash
sudo tail -n 200 /var/log/nginx/error.log
sudo tail -n 200 /var/log/nginx/access.log | grep "course-default.svg" -n
```

If Moodle is behind a proxy VM (see repo notes about VM 9001), check the proxied VM's logs as well.

5) Check file permissions and SELinux/AppArmor

- Ensure the webserver user can read the theme files. Example:

```bash
sudo chown -R www-data:www-data /var/www/moodle
sudo find /var/www/moodle -type f -exec chmod 644 {} +
sudo find /var/www/moodle -type d -exec chmod 755 {} +
```

6) If the image is generated by Moodle's cache (image.php endpoint)

- Clear MUC or theme caches, and check `Site administration -> Appearance -> Theme settings` for any custom image overrides.

7) Quick workaround

- Upload a static copy of `course-default.svg` into a web-accessible location on your server (e.g., `/var/www/moodle/static/course-default.svg`) and update the theme/template to point at the static path. This avoids image.php while you debug.

If you want, I can prepare a short patch (example nginx static mapping) or a small diagnostic script that hits the URL, fetches headers, and reports 404/403 and recent log matches.
